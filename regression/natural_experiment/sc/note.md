# 合成コントロール法（SC）  

## 0. Motivation  

DiDの２つの仮定を満たすことが難しい、処置群（比較対象）の選び方が恣意的or不明瞭(cherry picking)。  
SCではトリートメントグループもしくはコントロールグループのどちらか一方のデータが少ない時にも使える。  

**お気持ち**  
マッチングとDiDを組み合わせた分析。コントロールグループの中から、トリートメントグループと近い個体を選んで、重みづけをして(作成した合成対照群と)トリートメントグループと比べる。  

## 1. SCの概要  

トリートメントグループが少なく、コントロールグループが多い場合を考える。特に、処置群の個体1つ(個体$N$とする)に対し、対照群の個体は複数($N-1$とする)ある場合。  

- $i$：個体、両群合わせて$N$個（$i = 1, ..., N$）、ただし $i=N$ を処置群の個体、$j$を対照群の個体とする。
- $t$：時点、処置が行われた時点を$T$とする。
- $\omega_{j}$：重み、$\sum_{j=1}^{N-1}\omega_j=1, $ where $\omega_j \in [0,1]$
- $Y_{N,t}(1)$：処置群の結果変数  
- $Y_{j,t}(0)$：対処群の結果変数、$j = 1, ... , N-1$  

重み$\omega$は次式で推定する（推定方法はいくつかある）  
$$\hat{\omega} = \text{argmin}_{\omega}\sum_{t=1}^{T-1}\bigg(Y_{N,t} - \sum_{j=1}^{N-1}\omega_jY_{j,t}\bigg)$$  

つまり、処置が行われた時点$T$より前における対照群の結果変数が、処置群の結果変数との差が最小になる重みを推定する。  

この$\hat{\omega}$によって作成した合成対照群と処置群との差が因果効果  

### 必要な仮定  

**2. SCの課題**でも述べるように、対照群を重みづけて処置群を近似できるのか？  
**Perfect fit**は、これが満たされるという仮定  
There exists some $\alpha_j$
$$
\begin{align}
Y_{N,t}(0) = \sum_{j=1}^{N-1}\alpha_jY_{j,t}(0)
\qquad \text{s.t.} &\space \alpha_j \ge 0, \space \forall j \notag \\
&\sum_{j=1}^{N-1}\alpha_j = 1 \notag
\end{align}
$$

## 2. SCの課題  

1. 対照群から処置群の特性を近似することができない時には使えない  
   - 共変量が$T$前後で大きく変化する場合には適切に推定できない  
   - 個体の数が多く、時系列の長さが短い場合、合成対照群が不安定になる。  

