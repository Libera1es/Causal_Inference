# 回帰不連続デザイン（RDD）  

## 0. Motivation  

---
RCTでは、**ランダムに**トリートメントグループとコントロールグループに分けることで、処置以外の要因を考慮しなくてすむ（すなわち両群がまるで同じ個体のように扱える）ことで、両群を比較できた。現実ではランダムに振り分けることが難しい$\to$同じ個体としてみれない  

**お気持ち**  
何らかの観察された共変量を基準に、個体を処置群と対照群に分ける。その基準のギリギリのラインでは、RCTに近い（両群は処置以外に同じ個体として比較できる）状況が作れる  

RDDは法律（ex.飲酒年齢）やテストの合否など、強制的な基準（カットオフ値）があるときに、適用しやすい  


### 設定  

高校の数学の授業で中間テストを行い、その点数（強制変数）が４０点未満の生徒（トリートメントグループ）には補講を行った。この４０点がカットオフ値である。  
期末テストの点数をみることによって、補講によってどれほど点数が伸びるか知りたい。ここで、３９点の生徒と４０点の生徒は数学の理解度や授業への姿勢などの背景要因がとても似ていると考えられる。彼らの期末テストの点数を比べることで、補講の純粋な効果が得られそう  

## 1. RDDの概要  

---
基準となる変数$X_i$を強制変数（継続変数）といい、これがカットオフ値$c$よりも大きいか小さいかで$T_i=1$か$T_i=0$か決める。なので、$c$より大きいときに処置を行うとすれば、結果変数は
$$\begin{equation}
  Y_i= \bigg\{
  \begin{gathered}
    Y_i(0), if X_i < c \\
    Y_i(1), if X_i \ge c
  \end{gathered}
\end{equation}$$  

因果効果は、$c$におけるATEであるので、
$$ATE(X) = E[Y_i(1)|X_i=c] - E[Y_i(0)|X_i=c] $$  

このATEはカットオフ値という境界線付近だけから算出したものなので、局所的平均処置効果（LATE）といわれる  

### 必要な仮定  

- **連続性**：$E[Y_i(1)|X_i=x]$と$E[Y_i(0)|X_i=x]$が$x=c$で連続である。つまり、$$E[Y_i(1)-Y_i(0)|X_i=c]=\lim_{x\downarrow c}[Y_i(1)|X_i=x] - \lim_{x\uparrow c}[Y_i(0)|X_i=x]$$が成り立つ
- **non-manipulation**：処置群に入るかどうかを、個体自身が選ぶことはできない。例えば、補講があることを事前に知っている学生が、わざと４０点未満の点数をとり、補講受講の権利を獲得するということは、この仮定に反する  

### sharpRDDとfuzzyRDD  

上記ではカットオフ値の大小によって処置群か対照群かのどちらかに割り当てられるかが確定できまるが、これをsharpRDDという。  
処置の割り当てが確率的に決まる場合がfuzzyRDD  

## 2. 推定方法  

①バンド幅を決める  
バンド幅は、推定における強制変数の対象範囲を決める幅。バンド幅が小さい（大きい）とカットオフ値に近い（遠い）値のデータを使うのでバイアスが小さく（大きく）なるが、推定に使うデータが少なく（多く）なるので推定量の分散が大きく（小さく）なる。  
バンド幅の選択を行う際には、バイアスと分散の両方を考慮した平均二乗誤差（MSE）を指標とすることが多い。  

②回帰分析で推定値を算出する  
局所多多項帰式を用いる。特にLOESSとLOWESSが一般的で、LOWESSではカーネル密度推定を使用することで、カットオフ値近傍に重みづけをした推定を行う。カーネル関数にはいくつか種類がある。  

③MSEを計算する  

①から③をMSEを最小化するように繰り返し行い、最適なバンド幅を見つけ、そのデータで因果効果を推定する。  

## 3. 評価  

- **RDプロット**：データを強制変数の値をもとにいくつかに分割し、それぞれのグループ内の結果変数の平均を求めたうえで、その平均値をスムーズにした曲線と平均値をプロットする。カットオフ値近くで不連続になっていれば、その部分がＬＡＴＥである  
- **プラセボテスト**：カットオフ値を変化させてみて、その値において推定されたＬＡＴＥを確認する。ここで、有意にＬＡＴＥが推定されてしまった場合は、トリートメントグループとコントロールグループの差が偶然起こったものである可能性がある。  

