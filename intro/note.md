# 因果推論　概要  

## 0. Motivation  

__タイムマシンでも無い限り、同じ個体について、処置を行った場合と行わなかった場合の2つの状況を作り出す、観測することはできない__  

### 設定  

教授が試験前に、「今回の試験は簡単に作りました」と発言した場合、生徒のテストの点数が高くなるかどうか知りたい  

テストの点数：$Y$（結果変数）  
教授の発言：$T$ （処置） $T=1$なら処置あり、$T=0$なら処置なし  

#### Case1.  

生徒が１人（$i$さん）  

教授が発言した時の$i$さんのテスト結果が$Y_i(T=1)$、発言しなかった時のテスト結果が$Y_i(T=0)$  

**問題点**：$Y_i(T=1) - Y_i(T=0)$を求めたいけど、2つの結果変数は観測不可  

**解決策**：個人ではなく集団についてなら、２つの状況が作り出せる。  

#### Case2.  

生徒が２人（$i$と$j$）で、$i$にだけ発言して、$j$にはしない  

$i$と$j$のテストの結果を比較$Y_i(1) - Y_j(0)$  

**問題点**：  
元々$j$さんの頭が良かった可能性もあるし、たまたま$i$さんの得意な範囲が今回出題された場合もある。  

**解決策**：
個人と個人ではなく、グループとグループを比べれば、これらのような、処置に関係ない個々人の外部要因の影響を小さくできる  

#### Case3.  

生徒が100人いる。教室の前に座っている５０人（グループA）にだけ聞こえるように発言、後ろ５０人（グループB）には発言は聞こえない（つまり発言しないのと同じ）  

AとBそれぞれのテストの平均スコアを比較$E[Y_A(1)] - E[Y_B(0)]$  

**問題点**：  
テストで教室の前の方に座っている生徒は、講義を熱心に聞いていて、発言の有無関係なしにテストの点数が高いかもしれない  

**解決策**：  
グループへの振り分けはランダムに行う  

### Bestな因果推論  

**ランダム比較実験（RCT）**  
対象が処置あり（トリートメントグループ）と処置なし（コントロールグループ）に**ランダム**に振り分けられて、どちらの集団も**サイズが大きければ**、処置以外のブレが小さくなり、純粋な処置の効果(**因果効果**)がわかる


## 1. 因果効果の種類  

ある集団$g$をトリートメントグループ（処置群）$t$、コントロールグループ（対照群）$c$に分ける  

- **ITE**：$Y_i(1) - Y_i(0)$ where $i \in g$  
個体一つ一つの差を計算  

- **ATE**：$E[Y_g(1)] - E[Y_g(0)]$  
集団全体に処置を行った場合と、行わなかった場合の平均の差を計算  

- **CATE** ：$E[Y_g(1)|X=x] - E[Y_g(0)|X=x]$  
なんらかの変数Xによってグループ分けして、ATEを推定する  

- **ATT**：$E[Y_t(1)|T=1] - E[Y_t(0)|T=1]$  
処置群tについてのみ、処置ありとなしの場合の平均の差を計算  

- **CDTE**：CATEが平均を計算するのに対し、分布全体の違いを測定する


## 2. 因果推論のための仮定  

もし、$$ATE := E[Y_g(1)] - E[Y_g(0)] = E[Y_t(1)|T=1] - E[Y_c(0)|T=0]$$ なら、実際のデータからATEは識別（適切に推定）できる  

この等式が成り立つためにはいくつかの仮定が必要  

### 識別性条件  

1. **独立性(exchangeability)**：処置Tの割り当てが潜在的結果変数とは独立 $$ \{Y(1),Y(0)\} \bot T$$  
   NG例：  
   設定のCase3がこれに該当。Aをt、Bをcに割り振ったが、仮にAをcにしたとき、この平均点はcに割り振られたBの平均点とは異なる（前者の方が高くなる）  

2. **正値性**：すべての個体について、各処置に割り当てられる確率が0ではない  
   NG例：
   生徒の一部がイヤホンを装着したままだとする。このとき、教授の発言が聞こえることがないため、彼らがT=1に割り振られる確率は0になり、潜在的結果変数を定義できない。すなわち、$Y_{イヤホン}(1)$が存在しない  

### SUTVA(Stable unit treatment value assumption)  

3. **相互作用なし**：ある個体の処置が他の個体に影響しない  
   NG例：
   発言を聞いた$i$が発言を聞かなかった$j$に、教授が発言した旨を伝える  

4. **一致性**：処置を実際に受けた（受けていない）時の結果は，処置を受けた（受けていない）場合の潜在的結果に一致。処置の定義が曖昧な時に満たさない。  
   NG例：
    教授の発言を聞いたかどうかを処置とした場合、内容までは聞き取れなかったが、教授の声は聞こえたという生徒がいた場合、処置が一意にならず、定義の仕方次第で実際の点数と潜在的な点数が異なる  

## 3. 条件付き独立  

因果推論を適切に行うための1つ目の仮定として、独立性をあげた。その仮定を少し緩めたものが、条件付き独立性。  
なんらかの変数で条件づけた場合に独立性が成り立っていればよい

例：Case3において、講義に熱心かどうかで条件つけた場合、熱心（でない）なグループ内では、処置に対して潜在的結果変数が独立性を保つ  

### 因果効果の推定を邪魔する要因  

- **交絡因子** C：結果変数Yにも処置変数Tにも影響を与える(ex:C両親がヤクザ、T未成年喫煙する、Y少年院に入る確率)  

- **共変量** X：Yに影響する変数の中でTの影響を受けない変数（ex:X頭の良さ、T教授の発言、Yテストの点数）  

- **中間変数** M：Yに影響する変数の中で、Tの影響を受ける変数  

